<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Neuroverbs Real-Time</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div id="user-stats">
        XP Actual: <span id="local-xp">0</span>
    </div>

    <div id="leaderboard-container">
        <h3>Ranking en Tiempo Real</h3>
        <div id="leaderboard-list">Cargando ranking...</div>
    </div>

    <script>
        const SCRIPT_URL = "TU_URL_DE_DESPLIEGUE_AQUI"; // REEMPLAZAR
        let userToken = null;

        // 1. Manejar Inicio de Sesión
        function handleCredentialResponse(response) {
            userToken = response.credential;
            localStorage.setItem('neuroToken', userToken);
            console.log("Sesión activa");
            refreshLeaderboard();
        }

        // 2. Sincronizar XP (Llamar a esta función cuando el usuario gane puntos)
        async function syncXP(puntosGanados) {
            if (!userToken) return;

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Para evitar problemas de redirección de Google
                    body: JSON.stringify({
                        idToken: userToken,
                        xp: puntosGanados
                    })
                });
                console.log("Sincronización enviada");
            } catch (e) {
                console.error("Error sincronizando:", e);
            }
        }

        // 3. Obtener Ranking (Tiempo Real)
        async function refreshLeaderboard() {
            try {
                const res = await fetch(`${SCRIPT_URL}?action=leaderboard`);
                const data = await res.json();
                
                if (data.ok) {
                    const html = data.leaderboard.map((u, i) => `
                        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px;">
                            <span>${i+1}. ${u.name}</span>
                            <strong>${u.xp} XP</strong>
                        </div>
                    `).join('');
                    document.getElementById('leaderboard-list').innerHTML = html;
                }
            } catch (e) {
                console.log("Esperando actualización...");
            }
        }

        // 4. Bucle de Tiempo Real (Cada 20 segundos)
        setInterval(refreshLeaderboard, 20000);
        window.onload = refreshLeaderboard;

    </script>
</body>
</html>